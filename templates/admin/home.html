<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>„Éõ„Éº„É†</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/main.css') }}"
    />
  </head>
  <body>
    <div class="main">
      {% if message == "Ë™çË®º„Ç®„É©„Éº" %}
      <h1>{{message}}</h1>
      <a href="/admin/login">‚Üê Êàª„Çã</a>
      {% elif message != "Ë™çË®º„Ç®„É©„Éº" %}
      <h3 class="mb-3">„Çà„ÅÜ„Åì„Åù„ÄÅ {{message}} „Åï„Çì</h3>
      <div class="mb-3">
        <a href="/admin/login">„É≠„Ç∞„Ç¢„Ç¶„Éà</a>
      </div>
      <form action="/admin/sql_result" method="POST">
        <textarea
          class="form-control"
          id="sql_textarea"
          rows="4"
          type="text"
          name="sql"
          placeholder="SQL"
        ></textarea>
        <!-- auth info -->
        <input
          type="hidden"
          name="user_pass"
          value="{{ user_info.user_pass }}"
        />
        <input type="hidden" name="user_id" value="{{ user_info.user_id }}" />
        <!-- auth info END -->
        <div class="container mt-2">
          <div class="row row-cols-auto">
            <div class="col">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="radio"
                  name="flexRadioDefault"
                  id="flexRadioDefault1"
                  value="DELETE"
                />
                <label class="form-check-label" for="flexRadioDefault1">
                  DELETE
                </label>
              </div>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="radio"
                  name="flexRadioDefault"
                  id="flexRadioDefault2"
                  value="SELECT"
                  checked
                />
                <label class="form-check-label" for="flexRadioDefault2">
                  SELECT
                </label>
              </div>
            </div>
            <div class="col">
              <div class="btn-group mt-2">
                <button
                  type="button"
                  class="btn btn-secondary dropdown-toggle"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  „ÉÜ„Éº„Éñ„É´„ÇíÈÅ∏Êäû
                </button>
                <ul class="dropdown-menu">
                  {% for tbl_name in table_names %}
                  <li>
                    <a
                      class="dropdown-item"
                      href="#"
                      onclick="appendText(this.text)"
                      >{{ tbl_name }}</a
                    >
                  </li>
                  {% endfor %}
                </ul>
              </div>
            </div>
            <div class="col">
              <button
                id="doSQLBtn"
                class="btn btn-primary mt-2"
                type="submit"
                value="run"
              >
                ÂÆüË°å
              </button>
            </div>
            <div class="col">
              <div
                class="form-check mt-3"
                id="checkDoSQL"
                style="display: none"
              >
                <input
                  class="form-check-input"
                  type="checkbox"
                  value=""
                  id="flexCheckDefault"
                />
                <label class="form-check-label" for="flexCheckDefault">
                  Êú¨ÂΩì„Å´„ÉÜ„Éº„Éñ„É´„ÇíÁ©∫„Å´„Åó„Åæ„Åô„Åã„ÄÇ
                </label>
              </div>
            </div>
          </div>
        </div>
      </form>
      <hr />
      <div class="container mt-4 mb-3 p-4 bg-white">
        <div class="row">
          <div class="col">
            <h3>„Éá„Éº„Éñ„É´ÊÉÖÂ†± üìú</h3>
          </div>
          <div class="col">
            <div class="btn-group float-end">
              <button
                type="button"
                class="btn btn-secondary dropdown-toggle"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                „ÉÜ„Éº„Éñ„É´„ÇíÊ§úÁ¥¢
              </button>
              <ul class="dropdown-menu">
                {% for tbl_name in table_names %}
                <li>
                  <a class="dropdown-item" href="#{{ tbl_name }}"
                    >{{ tbl_name }}</a
                  >
                </li>
                {% endfor %}
              </ul>
            </div>
          </div>
        </div>
      </div>
      <!--  -->
      {% for columns in table_col_info_list %}
      <div class="mt-3 mb-3 p-4 bg-white" id="{{ columns[0].table_name }}">
        <div class="container">
          <div class="row">
            <div class="col">
              <a
                href="#{{ columns[0].table_name }}"
                class="text-decoration-none"
                ><h4 class="mt-2 mb-0 pb-0">{{ columns[0].table_name }}</h4></a
              >
            </div>
            <div class="col">
              <div class="float-end">
                <!-- send sql -->
                <form action="/admin/sql_result" method="POST">
                  <input
                    name="sql"
                    type="hidden"
                    value="SELECT * FROM {{ columns[0].table_name }}"
                  />
                  <!-- user info -->
                  <input
                    type="hidden"
                    name="user_pass"
                    value="{{ user_info.user_pass }}"
                  />
                  <input
                    type="hidden"
                    name="user_id"
                    value="{{ user_info.user_id }}"
                  />
                  <!--  -->
                  <button
                    id="doSQLBtn"
                    class="btn btn-secondary mt-2"
                    type="submit"
                    value="run"
                  >
                    „ÉÜ„Éº„Éñ„É´„ÇíË°®Á§∫
                  </button>
                </form>
              </div>
            </div>
          </div>
        </div>
        <!--  -->
        <div>
          <table class="table table-striped table-hover">
            <thead>
              <tr>
                <th>„Ç´„É©„É†Âêç</th>
                <th>„Éá„Éº„ÇøÂûã</th>
                <th>„Éá„Éï„Ç©„É´„ÉàÂÄ§</th>
                <th>Null Ë®±ÂÆπ</th>
                <th>‰∏ª„Ç≠„Éº„ÉªË§áÂêà‰∏ª„Ç≠„Éº</th>
              </tr>
            </thead>
            <tbody>
              {% for column in columns %}
              <tr>
                <td><code>{{ column.name }}</code></td>
                <td><code>{{ column.type }}</code></td>
                <td><code>{{ column.dflt_value }}</code></td>
                <td>
                  {% if not column.notnull != 0 %}
                  <span class="glyphicon glyphicon-ok">üÜó</span>
                  {% endif %}
                </td>
                <td>
                  {% if column.pk %}
                  <span class="glyphicon glyphicon-ok">üîë</span>
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          <!-- sql -->
          <div class="accordion" id="accordionExample{{ loop.index }}">
            <div class="accordion-item">
              <h4 class="accordion-header" id="headingTwo">
                <button
                  class="accordion-button collapsed"
                  type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#collapse{{ loop.index }}"
                  aria-expanded="false"
                  aria-controls="collapse{{ loop.index }}"
                >
                  SQL
                </button>
              </h4>
              <div
                id="collapse{{ loop.index }}"
                class="accordion-collapse collapse"
                aria-labelledby="headingTwo"
                data-bs-parent="#accordionExample{{ loop.index }}"
              >
                <div class="accordion-body bg-light">
                  <code class="message text-dark"
                    >{{ columns[0].table_sql }}</code
                  >
                </div>
              </div>
            </div>
          </div>
          <!--  -->
        </div>
      </div>
      {% endfor %} {% endif %}
      <p class="mt-5 mb-3 text-muted">¬© Circlejudge 2022</p>
    </div>
    <script
      type="text/javascript"
      src="{{ url_for('static', filename='js/main.js') }}"
    ></script>
  </body>
</html>
